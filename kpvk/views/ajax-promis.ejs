<%- include partials/header.ejs %>


<div class="jumbotron">
    <div class="container">
        <button class="btn btn-primary btn-lg" id="LoadNameBtn">Load User Details</button>
      
      <h1 class="display-3" id="display-name-div"></h1>

    </div>
  </div>


  <div id="myModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">LOADING .....</h5>
              
            </div>
            <div class="modal-body">
                <!-- Content will be loaded here from "remote.php" file -->
            </div>
           
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


<script>
    window.addEventListener('load',init);
    function init(){

        function makeAjaxcall(method,url,asinc){
            return new Promise((resolve,reject)=>{
                const xmlHttpReq = new XMLHttpRequest();
                xmlHttpReq.onreadystatechange = function (e) {
                    if (this.readyState === 4) {
                        if (this.status == 200) {
                            resolve(this.response);
                        } else {
                            reject(this.status);
                        }
                    }
               }
               xmlHttpReq.open(method, url,asinc);
               xmlHttpReq.send();


            });
        }

     // 1) selection buttion and place hoder to update result form server
        var loadDetailsBtn = document.getElementById('LoadNameBtn');
        var detailsPlace = document.getElementById('display-name-div');

          // 3) add event listner to button
          loadDetailsBtn.addEventListener("click",(e)=>{
                loadDetailsBtn.innerHTML = 'Loading............';
                let promis1 = makeAjaxcall("GET",'/ajax/getName',true);
                promis1.then((response)=>{
                    console.log(response);
                    makeAjaxcall("GET",'/ajax/getModifiedName'+"?name="+response,true)
                    .then((response)=>{
                        console.log(response);
                        makeAjaxcall("GET",'/ajax/getMessage'+"?name="+response,true)
                        .then((response)=>{
                            console.log(response);
                            return response;
                        }).then((response)=>{
                            detailsPlace.innerHTML = response;
                        });
                    })
                }).finally(() =>loadDetailsBtn.innerHTML = 'Load User Details');
                
            });


     }
</script>

</body>
</html>
